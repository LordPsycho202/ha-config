---
title: "Gardens"
theme: "minimalist-mobile-tapbar"
icon: mdi:greenhouse
path: garden
cards:
  - type: vertical-stack
    cards:
      - !include /config/ui-includes/alerts.yaml
      - !include ../includes/1-welcome.yaml

      - type: conditional
        conditions:
          - entity: binary_sensor.heat_index_active
            state: "on"
        card:
          type: custom:mushroom-template-card
          primary: >-
            {{ states('sensor.heat_index') | round(1) }}{{
            state_attr('sensor.heat_index','unit_of_measurement') }}
          secondary: Heat Index Warning
          icon: mdi:thermometer-alert
          icon_color: red
          tap_action:
            action: navigate
            navigation_path: weather

      - type: conditional
        conditions:
          - entity: switch.sprinklers
            state: "on"
        card:
          type: custom:mushroom-entity-card
          entity: switch.sprinklers
          icon: mdi:sprinkler-variant
          icon_color: light-blue
          fill_container: false
          tap_action:
            action: none
          hold_action:
            action: more-info
          double_tap_action:
            action: none

      - type: conditional
        conditions:
          - condition: numeric_state
            entity: sensor.monthly_water
            above: 5700
        card:
          type: gauge
          entity: sensor.monthly_water
          unit: gal
          name: Water Usage
          max: 10000
          min: 0
          severity:
            green: 0
            yellow: 5700
            red: 7500

      - type: conditional
        conditions:
          - condition: numeric_state
            entity: counter.days_without_rain
            above: 6
        card:
          type: custom:mushroom-template-card
          primary: >-
            {{ states('counter.days_without_rain') }} {{
            state_attr('counter.days_without_rain','friendly_name') }}
          secondary: >-
            Rain Chance: {{
            state_attr('weather.kwdr_daynight','forecast')[0].precipitation_probability
            }}%
          icon: '{{ state_attr(''counter.days_without_rain'',''icon'') }}'
          entity: counter.days_without_rain
          icon_color: |
            {% if states('counter.days_without_rain')|int > 0 %}
            red
            {% else %}
            blue
            {% endif %}
          tap_action:
            action: navigate
            navigation_path: weather

      - type: conditional
        conditions:
          - entity: lawn_mower.philoctetes
            state: "docked"
        card:
          type: custom:stack-in-card
          cards:
            - type: custom:mushroom-entity-card
              entity: sensor.philoctetes_next_start
              icon: mdi:robot-mower
              icon_color: blue
              tap_action:
                action: more-info
              hold_action:
                action: none
              double_tap_action:
                action: none

      - type: conditional
        conditions:
          - entity: lawn_mower.philoctetes
            state: "error"
        card:
          type: custom:stack-in-card
          cards:
            - type: custom:mushroom-template-card
              primary: "{{ state_attr('lawn_mower.philoctetes','friendly_name')|capitalize }}"
              secondary: "Error: {{ states('sensor.philoctetes_error')|replace('_',' ')|capitalize }}"
              icon: mdi:robot-mower
              icon_color: red
              tap_action:
                action: more-info
              hold_action:
                action: none
              double_tap_action:
                action: none

      - type: conditional
        conditions:
          - condition: or
            conditions: 
              - entity: lawn_mower.philoctetes
                state: "mowing"
              - entity: lawn_mower.philoctetes
                state: "returning"
        card:
          type: vertical-stack
          cards:
            - type: map
              entities:
                - entity: device_tracker.philoctetes
              theme_mode: auto
              default_zoom: 19
              auto_fit: true
            - type: "custom:button-card"
              template: card_vacuum
              entity: lawn_mower.philoctetes

  - type: vertical-stack
    cards:
      - type: "custom:button-card"
        template: card_title
        name: Indoor Greenhouse
      - type: horizontal-stack
        cards:
          - type: "custom:button-card"
            template: card_light
            entity: light.greenhouse
            variables:
              ulm_card_light_name: Plant Light
              ulm_card_light_force_background_color: true
              ulm_card_light_enable_collapse: true
      - type: custom:button-card
        template: card_navigate
        variables:
          ulm_card_navigate_path: /ui-lovelace-minimalist/plant_timelapse
          ulm_card_navigate_title: Timelapse Views
          ulm_card_navigate_icon: mdi:camera-burst
          ulm_card_navigate_color: var(--color-green)
      - type: custom:stack-in-card
        mode: horizontal
        cards:
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.temp_indoor_greenhouse
            variables:
              ulm_card_graph_color: "var(--google-green)"
              ulm_card_graph_name: Temperature
              ulm_card_graph_entity: sensor.temp_indoor_greenhouse
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
          - type: "custom:button-card"
            template: card_graph
            entity: sensor.humidity_indoor_greenhouse
            variables:
              ulm_card_graph_color: "var(--google-blue)"
              ulm_card_graph_name: Humidity
              ulm_card_graph_entity: sensor.humidity_indoor_greenhouse
              ulm_card_graph_type: fill
              ulm_card_graph_hours: 24
      - type: conditional
        conditions:
          - condition: or
            conditions:
              - condition: state
                entity: input_boolean.plant_notify_steve
                state: "on"
              - condition: state
                entity: input_boolean.plant_notify_fairy_washboard
                state: "on"      
              - condition: state
                entity: input_boolean.plant_notify_pitcher_plant
                state: "on"
              - condition: state
                entity: input_boolean.plant_notify_seeds
                state: "on"
              - condition: state
                entity: input_boolean.plant_notify_michael
                state: "on"   
        card:
          type: custom:expander-card
          title-card:
            type: custom:mushroom-template-card
            primary: Indoor Greenhouse
            secondary: |-
              Good: 
              {{
                states.plant
                | selectattr('entity_id', 'in', label_entities('indoor_greenhouse'))
                | selectattr('state','in','ok')
                | map(attribute='entity_id')
                | list | count
              }}
              | Needs Attention: 
              {{
                states.plant
                | selectattr('entity_id', 'in', label_entities('indoor_greenhouse'))
                | selectattr('state','in','problem')
                | map(attribute='entity_id')
                | list | count
              }}
            icon: mdi:greenhouse
            icon_color: |-
              {%- set problems = states.plant
                | selectattr('entity_id', 'in', label_entities('indoor_greenhouse'))
                | selectattr('state','in','problem')
                | map(attribute='entity_id')
                | list | count %}
              {% if problems | int > 0 %}red{% else %}green{% endif %}
          cards:
            - type: conditional
              conditions:
                - condition: state
                  entity: input_boolean.plant_notify_rose
                  state: "on"
              card:
                type: vertical-stack
                cards:
                  - type: custom:stack-in-card
                    mode: vertical
                    cards:
                      - type: custom:mushroom-template-card
                        primary: "{{ state_attr('plant.rose','friendly_name') }}"
                        entity: 'plant.rose'
                        layout: horizontal
                        tap_action:
                          action: 'navigate'
                          navigation_path: "plant_rose"
                        secondary: |-
                          {% if states('plant.rose') == 'ok' %}
                          We're Happy!
                          {% else %}
                            {%- set plant = 'plant.rose' %}
                            {%- set moisture = state_attr(plant,'moisture_status')|string %}
                            {%- set temp = state_attr(plant,'temperature_status')|string %}
                            {%- set cond = state_attr(plant,'conductivity_status')|string %}
                            {% if moisture == "Low"%}
                            Water Me, plz
                            {% elif moisture == "High"%}
                            Too Much Water
                            {% elif temp == "Low" %}
                            I'm Cold
                            {% elif temp == "High" %}
                            I'm Hot
                            {% elif cond == "Low" %}
                            Feed Me Seymore
                            {% elif cond == "High" %}
                            Just water, plz
                            {% else %}
                            mdi:flower-tulip-outline
                            {% endif %}
                          {% endif %}
                        icon: |-
                          {% if states('plant.rose') == 'ok' %}
                          mdi:flower-tulip-outline
                          {% else %}
                            {%- set plant = 'plant.rose' %}
                            {%- set moisture = state_attr(plant,'moisture_status')|string %}
                            {%- set temp = state_attr(plant,'temperature_status')|string %}
                            {%- set cond = state_attr(plant,'conductivity_status')|string %}
                            {% if moisture == "Low"%}
                            mdi:watering-can-outline
                            {% elif moisture == "High"%}
                            mdi:water-alert
                            {% elif temp == "Low" %}
                            mdi:snowflake-thermometer
                            {% elif temp == "High" %}
                            mdi:sun-thermometer-outline
                            {% elif cond == "Low" %}
                            mdi:seed-plus-outline
                            {% elif cond == "High" %}
                            mdi:seed-off-outline
                            {% else %}
                            mdi:flower-tulip-outline
                            {% endif %}
                          {% endif %}
                        icon_color: |-
                          {% if states('plant.rose') == 'ok' %}
                          green
                          {% else %}
                            {%- set plant = 'plant.rose' %}
                            {%- set moisture = state_attr(plant,'moisture_status')|string %}
                            {%- set temp = state_attr(plant,'temperature_status')|string %}
                            {%- set cond = state_attr(plant,'conductivity_status')|string %}
                            {% if moisture == "Low"%}
                            brown
                            {% elif moisture == "High"%}
                            blue
                            {% elif temp == "Low" %}
                            cyan
                            {% elif temp == "High" %}
                            red
                            {% elif cond == "Low" %}
                            cyan
                            {% elif cond == "High" %}
                            blue
                            {% else %}
                            green
                            {% endif %}
                          {% endif %}
                      - type: custom:stack-in-card
                        mode: horizontal
                        cards:
                          - type: gauge
                            entity: 'sensor.rose_soil_moisture'
                            name: Soil Moisture
                            unit: "%"
                            min: 0
                            max: 100
                            needle: true
                            header_position: bottom
                            segments:
                              - from: 0
                                color: "#A0522D"
                                label: Water
                              - color: "#008000"
                                from: '16'
                              - color: "#0000FF"
                                from: '76'
                                label: Too Wet
                          - type: custom:mini-graph-card
                            entities:
                              - '[[plant_moisture_entity]]'
                            line_color: '#008000'
                            show:
                              state: false
                            line_width: 8
                            name: History
                  


      - type: custom:mushroom-template-card
        primary: Duck
        icon: mdi:chili-mild
        icon_color: red